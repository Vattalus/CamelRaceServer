function generateFailObj(b,a){return{Result:"Failed",Message:b,Data:a}}function generateErrObj(b,a){return{Result:"Error",Message:b,Data:a}}function loadTitleDataJson(b){var a=server.GetTitleData({PlayFabId:currentPlayerId,Keys:[b]});if(void 0==a||void 0==a.Data||void 0==a.Data[b])return null;b=JSON.parse(a.Data[b]);return void 0==b?null:b}function getServerTime(){return Math.floor((new Date).getTime()/1E3)}
function randomRange(b,a){return Math.round(Math.random()*(Number(a)-Number(b)))+Number(b)}function addCurrency(b,a){server.AddUserVirtualCurrency({PlayFabId:currentPlayerId,VirtualCurrency:b,Amount:a})}
handlers.grantOasis=function(b,a){a=loadTitleDataJson("Balancing_Oasis");if(void 0==a||null==a)return generateErrObj("Oasis Balancing JSON undefined or null");var c=server.GetUserReadOnlyData({PlayFabId:currentPlayerId,Keys:["lastClaimedOasisTimestamp"]});b=getServerTime();log.debug("var undefined: ",void 0==c.Data.lastClaimedOasisTimestamp);log.debug("value undefined: ",void 0==c.Data.lastClaimedOasisTimestamp.Value);log.debug("value: ",c.Data.lastClaimedOasisTimestamp.Value);log.debug("recharge interval: ",
Number(3600*a.rechargeInterval));log.debug("ready at: ",Number(c.Data.lastClaimedOasisTimestamp.Value)+Number(3600*a.rechargeInterval));log.debug("server time: "+b);log.debug("Should be ready: "+Number(c.Data.lastClaimedOasisTimestamp.Value)+Number(36E5*a.rechargeInterval)<b);if(void 0!=c.Data.lastClaimedOasisTimestamp&&void 0!=c.Data.lastClaimedOasisTimestamp.Value&&Number(c.Data.lastClaimedOasisTimestamp.Value)+Number(36E5*a.rechargeInterval)>b)return generateFailObj("Oasis not ready yet",c.Data.lastClaimedOasisTimestamp.Value);
var c=randomRange(a.scRewardBase,2*a.scRewardBase),d=randomRange(a.hcRewardMin,a.hcRewardMax);a=randomRange(a.ticketsRewardMin,a.ticketsRewardMax);addCurrency("SC",c);addCurrency("HC",d);addCurrency("TK",a);server.UpdateUserReadOnlyData({PlayFabId:currentPlayerId,Data:{lastClaimedOasisTimestamp:b}});a=server.GetUserInventory({PlayFabId:currentPlayerId}).VirtualCurrency;return{lastOasisTimestamp:b,VirtualCurrency:a}};
handlers.raceEnd=function(b,a){null!=b&&b.endRaceReward&&Number(b.endRaceReward)&&addCurrency("SC",Number(b.endRaceReward));return{Result:"OK"}};
