function generateFailObj(a,b){return{Result:"Failed",Message:a,Data:b}}function generateErrObj(a,b){return{Result:"Error",Message:a,Data:b}}function loadTitleDataJson(a){var b=server.GetTitleData({PlayFabId:currentPlayerId,Keys:[a]});if(void 0==b||void 0==b.Data||void 0==b.Data[a])return null;a=JSON.parse(b.Data[a]);return void 0==a?null:a}function getServerTime(){return Math.floor((new Date).getTime()/1E3)}
function randomRange(a,b){return Math.round(Math.random()*(Number(b)-Number(a)))+Number(a)}function addCurrency(a,b){server.AddUserVirtualCurrency({PlayFabId:currentPlayerId,VirtualCurrency:a,Amount:b})}
handlers.grantOasis=function(a,b){b=loadTitleDataJson("Balancing_Oasis");if(void 0==b||null==b)return generateErrObj("Oasis Balancing JSON undefined or null");var c=getNextOasisTime(b.rechargeInterval);a=getServerTime();if(c>a)return generateFailObj("Oasis not ready yet",c);var c=randomRange(b.scRewardBase,2*b.scRewardBase),d=randomRange(b.hcRewardMin,b.hcRewardMax);b=randomRange(b.ticketsRewardMin,b.ticketsRewardMax);addCurrency("SC",c);addCurrency("HC",d);addCurrency("TK",b);server.UpdateUserReadOnlyData({PlayFabId:currentPlayerId,
Data:{lastClaimedOasisTimestamp:a}});b=server.GetUserInventory({PlayFabId:currentPlayerId}).VirtualCurrency;return{lastOasisTimestamp:a,VirtualCurrency:b}};handlers.getOasisData=function(a,b){a=loadTitleDataJson("Balancing_Oasis");return void 0==a||null==a?generateErrObj("Oasis Balancing JSON undefined or null"):getNextOasisTime(a.rechargeInterval)};
function getNextOasisTime(a){var b=server.GetUserReadOnlyData({PlayFabId:currentPlayerId,Keys:["lastClaimedOasisTimestamp"]}),c=0;void 0!=b.Data.lastClaimedOasisTimestamp&&void 0!=b.Data.lastClaimedOasisTimestamp.Value&&(c=Number(b.Data.lastClaimedOasisTimestamp.Value));return c+3600*Number(a)}handlers.raceEnd=function(a,b){null!=a&&a.endRaceReward&&Number(a.endRaceReward)&&addCurrency("SC",Number(a.endRaceReward));return{Result:"OK"}};
handlers.endRace_quick=function(a,b){b=loadTitleDataJson("RaceRewards_Quick");if(void 0==b||null==b)return generateErrObj("RaceRewards_Quick JSON undefined or null");a=GiveRaceRewards(a,b);return null!=a?generateErrObj(a):{VirtualCurrency:server.GetUserInventory({PlayFabId:currentPlayerId}).VirtualCurrency}};
function GiveRaceRewards(a,b){var c=Number(0);a=b.Placement_SC[a.finishPosition];void 0==a||null==a||isNaN(Number(a))||(c+=Number(a));c+=Number(b.MaxStartBonus);c+=Number(b.MaxFinishBonus);log.debug("sc reward: ",c);return null};
